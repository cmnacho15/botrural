# üìÖ Calendario - Bot Rural

## Resumen

Sistema de calendario integrado con WhatsApp y la web.

### Funcionalidadess:
- ‚úÖ Crear actividades desde WhatsApp (audio o texto)
- ‚úÖ Crear actividades desde la web
- ‚úÖ Consultar pendientes desde WhatsApp
- ‚úÖ Ver calendario visual en la web
- ‚úÖ Marcar como realizada desde la web
- ‚úÖ Colores por estado (pendiente, hoy, vencida, realizada)
- ‚úÖ Zona horaria Uruguay

---

## üìÅ Archivos incluidos

| Archivo | Destino | Descripci√≥n |
|---------|---------|-------------|
| `openai-parser.ts` | `src/lib/openai-parser.ts` | Parser actualizado con tipos CALENDARIO |
| `calendarioHandler.ts` | `src/lib/whatsapp/handlers/calendarioHandler.ts` | Handlers de WhatsApp |
| `api-calendario-route.ts` | `src/app/api/calendario/route.ts` | API GET/POST |
| `api-calendario-id-route.ts` | `src/app/api/calendario/[id]/route.ts` | API PATCH/DELETE |
| `calendario-page.tsx` | `src/app/dashboard/calendario/page.tsx` | P√°gina del calendario |
| `INTEGRACION-BOT-WEBHOOK.ts` | (instrucciones) | C√≥digo para integrar en el webhook |
| `INSTRUCCIONES-SIDEBAR.ts` | (instrucciones) | C√≥mo agregar al sidebar |

---

## üöÄ Pasos de implementaci√≥n

### 1. Schema de Prisma

Agregar al final de `prisma/schema.prisma`:
```prisma
model ActividadCalendario {
  id                String    @id @default(cuid())
  campoId           String
  usuarioId         String?
  
  titulo            String
  fechaProgramada   DateTime  @db.Date
  realizada         Boolean   @default(false)
  fechaRealizacion  DateTime?
  
  origen            String    @default("WEB")
  notas             String?
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  campo             Campo     @relation(fields: [campoId], references: [id], onDelete: Cascade)
  
  @@index([campoId])
  @@index([fechaProgramada])
  @@index([realizada])
}
```

Y en el modelo `Campo` agregar:
```prisma
actividadesCalendario ActividadCalendario[]
```

Luego ejecutar:
```bash
npx prisma db push
```

### 2. Copiar archivos
```bash
# Parser actualizado
cp openai-parser.ts src/lib/openai-parser.ts

# Handler de WhatsApp
cp calendarioHandler.ts src/lib/whatsapp/handlers/calendarioHandler.ts

# API
mkdir -p src/app/api/calendario/[id]
cp api-calendario-route.ts src/app/api/calendario/route.ts
cp api-calendario-id-route.ts src/app/api/calendario/[id]/route.ts

# P√°gina
mkdir -p src/app/dashboard/calendario
cp calendario-page.tsx src/app/dashboard/calendario/page.tsx
```

### 3. Actualizar el webhook

Ver archivo `INTEGRACION-BOT-WEBHOOK.ts` para el c√≥digo exacto.

Resumen:
1. Importar los handlers de calendario
2. Agregar los casos `CALENDARIO_CREAR` y `CALENDARIO_CONSULTAR` antes del switch existente
3. Actualizar el mensaje de ayuda

### 4. Exportar handlers

En `src/lib/whatsapp/index.ts`, agregar:
```typescript
export {
  handleCalendarioCrear,
  handleCalendarioConsultar,
} from "./handlers/calendarioHandler"
```

### 5. Agregar al sidebar

En tu `layout.tsx` del dashboard, agregar el link:
```typescript
{ href: '/dashboard/calendario', icon: 'üìÖ', label: 'Calendario' }
```

---

## üí¨ Ejemplos de uso por WhatsApp

### Crear actividades:
- "en 14 d√≠as tengo que sacar tablilla"
- "acordame el martes de llamar al veterinario"
- "la semana que viene hay que vacunar"
- "ma√±ana llega el cami√≥n"
- "pasado ma√±ana pagar al pe√≥n"
- "el 20 revisar bebederos"

### Consultar pendientes:
- "calendario"
- "pendientes"
- "qu√© tengo agendado"
- "qu√© hay para hacer"

---

## üé® Estados visuales

| Estado | Color | Descripci√≥n |
|--------|-------|-------------|
| Pendiente | üîµ Azul | Actividad futura |
| Hoy | üü° Amarillo | Actividad para hoy |
| Vencida | üî¥ Rojo | No realizada y pas√≥ la fecha |
| Realizada | üü¢ Verde | Marcada como completada |

---

## ‚ö†Ô∏è Notas

- Las actividades vencidas se muestran hasta 7 d√≠as despu√©s
- Solo se puede marcar como realizada desde la web